"use strict";var e=require("vue");function t(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(i){if("default"!==i){var o=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(t,i,o.get?o:{enumerable:!0,get:function(){return e[i]}})}})),t.default=e,Object.freeze(t)}var i=t(require("monaco-editor")),o=e.defineComponent({name:"MonacoEditor",props:{diffEditor:{type:Boolean,default:!1},width:{type:[String,Number],default:"100%"},height:{type:[String,Number],default:"100%"},original:String,value:String,language:{type:String,default:"javascript"},theme:{type:String,default:"vs"},options:{type:Object,default:()=>({})},validation:{type:Object,default:()=>({})}},emits:["editorWillMount","editorDidMount","change"],setup(t){const{width:i,height:o}=e.toRefs(t),a=e.computed((()=>({width:i.value.toString().includes("%")?i.value:`${i.value}px`,height:o.value.toString().includes("%")?o.value:`${o.value}px`,"text-align":"left"}))),s=e.ref("");return{style:a,modelId:s,updateModelId:function(){s.value=`file:///file-${(new Date).getTime()}.yaml`}}},mounted(){this.initMonaco()},beforeUnmount(){i.editor.getModel(this.modelId)?.dispose(),this.$monacoValidationOptions&&(this.$monacoValidationOptions.schemas=this.$monacoValidationOptions.schemas.filter((e=>!e.fileMatch.includes(this.modelId)))),this.editor&&this.editor.dispose()},methods:{async initMonaco(){this.updateModelId(),this.$emit("editorWillMount",this.monaco);const{value:e,language:t,theme:o,options:a,original:s,validation:n}=this;if(this.diffEditor){const n=i.editor.createModel(s,t),l=i.editor.createModel(e,t);this.editor=i.editor.createDiffEditor(this.$el,{automaticLayout:!0,theme:o,fixedOverflowWidgets:!0,...a}),this.editor.setModel({original:n,modified:l})}else{const s=i.editor.createModel(e,t,i.Uri.parse(this.modelId));if(n.uri)if(n.schema?.type){const e=[...this.$monacoValidationOptions?.schemas||[],{fileMatch:[this.modelId],schema:n.schema,uri:n.uri}];this.$monacoValidationOptions&&(this.$monacoValidationOptions.schemas=e),this.$monacoYaml&&this.$monacoYaml.update({schemas:e}),i.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,enableSchemaRequest:!1,schemas:e,allowComments:!0})}else{const e=await fetch(n.uri);if(e.ok){const t=await e.json(),o=[...this.$monacoValidationOptions?.schemas||[],{fileMatch:[this.modelId],schema:t,uri:n.uri}];this.$monacoValidationOptions&&(this.$monacoValidationOptions.schemas=o),this.$monacoYaml&&this.$monacoYaml.update({schemas:o,enableSchemaRequest:!0}),i.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,enableSchemaRequest:!0,schemas:o,allowComments:!0})}else this.$monacoYaml&&this.$monacoYaml.update({validate:!1}),i.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!1})}this.editor=i.editor.create(this.$el,{automaticLayout:!0,model:s,theme:o,fixedOverflowWidgets:!0,...a})}const l=this._getEditor();l.onDidChangeModelContent((e=>{const t=l.getValue();this.value!==t&&this.$emit("change",t,e)})),this.$emit("editorDidMount",this.editor)},_setValue(e){let t=this._getEditor();if(t)return t.setValue(e)},_getValue(){let e=this._getEditor();return e?e.getValue():""},_getEditor(){return this.editor?this.diffEditor?this.editor.getModifiedEditor():this.editor:null},_setOriginal(){const{original:e}=this.editor.getModel();e.setValue(this.original)}},watch:{options:{deep:!0,handler(e){this.editor.updateOptions(e)}},value(){this.value!==this._getValue()&&this._setValue(this.value)},original(){this._setOriginal()},language(){if(this.editor)if(this.diffEditor){const{original:e,modified:t}=this.editor.getModel();i.editor.setModelLanguage(e,this.language),i.editor.setModelLanguage(t,this.language)}else i.editor.setModelLanguage(this.editor.getModel(),this.language)},theme(){i.editor.setTheme(this.theme)}}});o.render=function(t,i,o,a,s,n){return e.openBlock(),e.createElementBlock("div",{class:"monaco-editor-vue3",style:e.normalizeStyle(t.style)},null,4)},exports.default=o;